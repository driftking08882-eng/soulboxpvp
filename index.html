<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Soul Box PVP â€” Dashboard</title>
<style>
:root {
    --bg: #f5f5f5;
    --card: #ffffff;
    --accent: #ffcc00;
    --text: #222222;
    --muted: #666666;
    --success: #00c853;
    --error: #ff3b30;
    --shadow: rgba(0,0,0,0.1);
}
*{box-sizing:border-box;}
body{
    margin:0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg);
    color: var(--text);
    display:flex;
    flex-direction:column;
    min-height:100vh;
    justify-content:space-between;
}
header{
    text-align:center;
    padding:2rem 1rem 0;
}
h1{
    font-size:2rem;
    margin:0;
    color: var(--accent);
    letter-spacing:1px;
}
.container{
    flex:1;
    display:flex;
    justify-content:center;
    align-items:center;
    padding:2rem;
}
.card{
    width:360px;
    background: var(--card);
    border-radius:15px;
    box-shadow:0 6px 20px var(--shadow);
    padding:2rem;
    position:relative;
    text-align:center;
}
.card h2{
    margin:0 0 1rem 0;
    font-size:1.3rem;
    word-break: break-word;
    overflow-wrap: break-word;
}
.card p{
    margin:0.5rem 0;
    font-size:1rem;
    word-break: break-word;
}
button{
    margin-top:1rem;
    padding:0.6rem 1.2rem;
    border:none;
    border-radius:8px;
    background: var(--accent);
    color: var(--text);
    font-weight:700;
    cursor:pointer;
    transition:0.2s;
}
button:hover{
    background:#e6b800;
}
.notif{
    position:absolute;
    top:-30px;
    left:50%;
    transform:translateX(-50%);
    background:#00c853;
    color:#fff;
    padding:6px 12px;
    border-radius:6px;
    font-size:0.85rem;
    font-weight:700;
    opacity:0;
    pointer-events:none;
    transition:0.4s;
}
.notif.show{
    opacity:1;
    top:-40px;
}
.stats{
    display:flex;
    justify-content:space-between;
    margin-top:15px;
}
.stat{
    flex:1;
    background: #f0f0f0;
    margin:0 5px;
    border-radius:10px;
    padding:10px;
}
.stat .label{
    font-size:0.8rem;
    color: var(--muted);
}
.stat .value{
    font-size:1.2rem;
    font-weight:700;
    margin-top:4px;
}
.motd{
    margin-top:15px;
    font-size:0.95rem;
    color: var(--text);
    word-break:break-word;
    line-height:1.2;
}
footer{
    text-align:center;
    padding:1rem;
    font-size:0.85rem;
    color:var(--muted);
}
.emoji{
    font-family: "Segoe UI Emoji", "Noto Color Emoji", "Apple Color Emoji", sans-serif;
}
</style>
</head>
<body>
<header>
</header>

<main class="container">
    <div class="card" id="card">
        <div class="notif" id="notif">Refreshed!</div>
        <h2 id="ip">soulboxpvp.aternos.me:59911</h2>
        <p id="status"><span id="statusEmoji" class="emoji">ðŸ”´</span> <span id="statusText">Offline</span></p>
        <div class="stats">
            <div class="stat">
                <div class="label">Version</div>
                <div class="value" id="version">â€”</div>
            </div>
            <div class="stat">
                <div class="label">Players</div>
                <div class="value" id="players">â€”/â€”</div>
            </div>
        </div>
        <div class="motd" id="motd">â€”</div>
        <div class="stats" style="margin-top:10px;">
            <div class="stat">
                <div class="label">Ping</div>
                <div class="value" id="ping">â€”</div>
            </div>
            <div class="stat">
                <div class="label">Proxy</div>
                <div class="value" id="proxy">â€”</div>
            </div>
        </div>
        <button id="refreshBtn">Refresh âŸ³</button>
    </div>
</main>

<footer>Copyright 2025 Soul Box PVP</footer>

<script>
const serverIP = 'soulboxpvp.aternos.me:59911';
const statusEmoji = document.getElementById('statusEmoji');
const statusText = document.getElementById('statusText');
const versionEl = document.getElementById('version');
const playersEl = document.getElementById('players');
const motdEl = document.getElementById('motd');
const pingEl = document.getElementById('ping');
const proxyEl = document.getElementById('proxy');
const notif = document.getElementById('notif');
const refreshBtn = document.getElementById('refreshBtn');

let initialLoad = true;

async function fetchServer(showNotif=false){
    try{
        const res = await fetch(`https://api.mcsrvstat.us/2/${serverIP}`, {cache:"no-store"});
        const data = await res.json();

        // Check if server is truly offline
        let isOffline = true;
        if(data && data.online === true){
            // Aternos sometimes sets online:true even when offline, so check MOTD
            const motdText = (data.motd?.clean?.join(' ') ?? '').toLowerCase();
            if(!motdText.includes('this server is offline')){
                isOffline = false;
            }
        }

        if(isOffline){
            setOffline();
        } else {
            updateUI(data);
        }

        if(!initialLoad && showNotif) showNotification('Refreshed!');
    } catch {
        setOffline();
        if(!initialLoad && showNotif) showNotification('Refreshed!');
    } finally {
        initialLoad = false;
    }
}

function updateUI(data){
    statusEmoji.textContent = 'ðŸŸ¢';
    statusText.textContent = 'Online';
    versionEl.textContent = data.version || 'Unknown';
    const online = (data.players?.online ?? 0);
    const max = (data.players?.max ?? 0);
    playersEl.textContent = `${online}/${max}`;
    motdEl.textContent = data.motd?.clean?.join(' ') || 'â€”';
    const pingVal = typeof data.debug?.ping === 'number' ? data.debug.ping : 'N/A';
    pingEl.textContent = pingVal==='N/A'? 'N/A': pingVal + ' ms';
    proxyEl.textContent = data.proxy ? 'Yes':'No';
}

function setOffline(){
    statusEmoji.textContent = 'ðŸ”´';
    statusText.textContent = 'Offline';
    versionEl.textContent = 'Offline';
    playersEl.textContent = '0/â€”';
    motdEl.textContent = 'This server is offline. Get this server more RAM for free! > craft.link/ram';
    pingEl.textContent = 'N/A';
    proxyEl.textContent = 'No';
}

function showNotification(text){
    notif.textContent = text;
    notif.classList.add('show');
    setTimeout(()=>notif.classList.remove('show'),1400);
}

refreshBtn.addEventListener('click', ()=>fetchServer(true));
fetchServer(false);
</script>
</body>
</html>
